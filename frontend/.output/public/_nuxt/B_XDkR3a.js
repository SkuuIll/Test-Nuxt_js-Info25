import{_ as F}from"./9ykhWItT.js";import{d as T,I as L,s as y,r as d,J as M,x as R,u as G,c as o,f as e,z as w,n as S,v as Q,h as r,p as U,H as N,a as v,F as B,k as D,o as i,t as l,L as f}from"./BE3ND16f.js";import{u as J}from"./CRYnRe3J.js";const q={class:"space-y-6"},K={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4"},O={class:"flex flex-wrap gap-4"},W={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},X={key:0,class:"p-8 text-center"},Y={key:1,class:"p-8 text-center"},Z={key:2,class:"overflow-x-auto"},tt={class:"w-full"},et={class:"divide-y divide-gray-200 dark:divide-gray-700"},at={class:"px-6 py-4"},st={class:"flex items-center"},rt={class:"w-10 h-10 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center mr-3"},ot={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},it={class:"text-sm font-medium text-gray-900 dark:text-white"},nt={class:"text-sm text-gray-500 dark:text-gray-400"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},dt={class:"px-6 py-4 whitespace-nowrap"},ct={class:"px-6 py-4 whitespace-nowrap"},ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},pt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},xt={class:"flex items-center justify-end space-x-2"},gt=["onClick","title"],ft=["onClick","title"],mt={key:0,class:"flex justify-center"},yt={class:"flex space-x-2"},vt=["onClick"],wt=T({__name:"index",setup(ht){const{handleSuccess:$,handleError:c}=L(),{user:A}=y(),h=d(!1),m=d([]),g=d(""),u=d(""),p=d(""),x=d(1),_=d(1),H=s=>s.split(" ").map(a=>a.charAt(0)).join("").toUpperCase().substring(0,2),I=s=>s.is_superuser?"Superusuario":s.is_staff?"Staff":"Usuario",P=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"Nunca",k=async()=>{try{h.value=!0;const{token:s}=y();if(!s.value){c("No se encontró token de autenticación","fetchUsers");return}const a=new URLSearchParams;g.value&&a.append("search",g.value),u.value&&a.append("role",u.value),p.value&&a.append("status",p.value),a.append("page",x.value.toString());const n=await $fetch(`/api/v1/dashboard/api/users/?${a}`,{headers:{Authorization:`Bearer ${s.value}`}});m.value=n.results||n,_.value=Math.ceil((n.count||m.value.length)/10)}catch(s){console.error("Error fetching users:",s),c("Error al cargar los usuarios","fetchUsers")}finally{h.value=!1}},V=async s=>{try{const{token:a}=y();if(!a.value){c("No se encontró token de autenticación","toggleUserStatus");return}await $fetch(`/api/v1/dashboard/api/users/${s.id}/`,{method:"PATCH",body:{is_active:!s.is_active},headers:{Authorization:`Bearer ${a.value}`}}),s.is_active=!s.is_active,$(`Usuario ${s.is_active?"activado":"desactivado"} exitosamente`)}catch{c("Error al cambiar el estado del usuario","toggleUserStatus")}},j=async s=>{try{const{token:a}=y();if(!a.value){c("No se encontró token de autenticación","toggleStaffStatus");return}await $fetch(`/api/v1/dashboard/api/users/${s.id}/`,{method:"PATCH",body:{is_staff:!s.is_staff},headers:{Authorization:`Bearer ${a.value}`}}),s.is_staff=!s.is_staff,$(`Permisos de staff ${s.is_staff?"otorgados":"removidos"} exitosamente`)}catch{c("Error al cambiar los permisos del usuario","toggleStaffStatus")}},C=J(()=>{x.value=1,k()},500);return M([u,p,x],()=>{k()}),R(()=>{k()}),G({title:"Gestionar Usuarios - Administración",meta:[{name:"description",content:"Administrar usuarios del blog"}]}),(s,a)=>{const n=F;return i(),o("div",q,[a[10]||(a[10]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Gestionar Usuarios "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Administra las cuentas de usuario del blog ")])],-1)),e("div",K,[e("div",O,[S(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>U(g)?g.value=t:null),type:"text",placeholder:"Buscar usuarios...",class:"input flex-1 min-w-64",onInput:a[1]||(a[1]=(...t)=>r(C)&&r(C)(...t))},null,544),[[Q,r(g)]]),S(e("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>U(u)?u.value=t:null),class:"input"},a[4]||(a[4]=[e("option",{value:""},"Todos los roles",-1),e("option",{value:"superuser"},"Superusuarios",-1),e("option",{value:"staff"},"Staff",-1),e("option",{value:"regular"},"Usuarios regulares",-1)]),512),[[N,r(u)]]),S(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>U(p)?p.value=t:null),class:"input"},a[5]||(a[5]=[e("option",{value:""},"Todos los estados",-1),e("option",{value:"active"},"Activos",-1),e("option",{value:"inactive"},"Inactivos",-1)]),512),[[N,r(p)]])])]),e("div",W,[r(h)?(i(),o("div",X,[v(n,{name:"loading",class:"w-8 h-8 animate-spin mx-auto mb-4 text-gray-400"}),a[6]||(a[6]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando usuarios...",-1))])):r(m).length===0?(i(),o("div",Y,[v(n,{name:"users",class:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a[7]||(a[7]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," No hay usuarios ",-1)),a[8]||(a[8]=e("p",{class:"text-gray-600 dark:text-gray-400"}," No se encontraron usuarios con los filtros aplicados. ",-1))])):(i(),o("div",Z,[e("table",tt,[a[9]||(a[9]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Usuario "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Email "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Rol "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Estado "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Último acceso "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",et,[(i(!0),o(B,null,D(r(m),t=>{var b,E;return i(),o("tr",{key:t.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",at,[e("div",st,[e("div",rt,[e("span",ot,l(H(t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.username)),1)]),e("div",null,[e("div",it,l(t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.username),1),e("div",nt," @"+l(t.username),1)])])]),e("td",lt,l(t.email),1),e("td",dt,[e("span",{class:f([{"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":t.is_superuser,"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":t.is_staff&&!t.is_superuser,"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200":!t.is_staff&&!t.is_superuser},"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},l(I(t)),3)]),e("td",ct,[e("span",{class:f([{"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":t.is_active,"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":!t.is_active},"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},l(t.is_active?"Activo":"Inactivo"),3)]),e("td",ut,l(P(t.last_login)),1),e("td",pt,[e("div",xt,[t.id!==((b=r(A))==null?void 0:b.id)?(i(),o("button",{key:0,onClick:z=>V(t),class:f({"text-green-600 hover:text-green-900":!t.is_active,"text-red-600 hover:text-red-900":t.is_active}),title:t.is_active?"Desactivar":"Activar"},[v(n,{name:t.is_active?"user-minus":"user-plus",class:"w-4 h-4"},null,8,["name"])],10,gt)):w("",!0),t.id!==((E=r(A))==null?void 0:E.id)&&!t.is_superuser?(i(),o("button",{key:1,onClick:z=>j(t),class:f({"text-blue-600 hover:text-blue-900":!t.is_staff,"text-gray-600 hover:text-gray-900":t.is_staff}),title:t.is_staff?"Quitar staff":"Hacer staff"},[v(n,{name:"shield-check",class:"w-4 h-4"})],10,ft)):w("",!0)])])])}),128))])])]))]),r(_)>1?(i(),o("div",mt,[e("nav",yt,[(i(!0),o(B,null,D(r(_),t=>(i(),o("button",{key:t,onClick:b=>x.value=t,class:f([{"bg-primary-600 text-white":t===r(x),"bg-white text-gray-700 hover:bg-gray-50":t!==r(x)},"px-3 py-2 text-sm font-medium rounded-md border border-gray-300"])},l(t),11,vt))),128))])])):w("",!0)])}}});export{wt as default};
