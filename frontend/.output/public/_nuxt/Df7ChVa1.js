import{U as s,T as d,q as u,D as i,V as h}from"./BE3ND16f.js";const P=s(async(e,g)=>{let r,a;try{const n=d(),t=u(),l=t.tokenUtils.getTokens();if(!l.access||t.tokenUtils.isTokenExpired(l.access)){console.log("ðŸ”’ No valid tokens, redirecting to login");const o=e.fullPath!=="/login"?e.fullPath:"/";return i(`/login?redirect=${encodeURIComponent(o)}`)}if(!n.isAuthenticated)try{if([r,a]=h(()=>n.initializeAuth()),await r,a(),!n.isAuthenticated){console.log("ðŸ”’ Authentication initialization failed, redirecting to login"),t.tokenUtils.clearTokens();const o=e.fullPath!=="/login"?e.fullPath:"/";return i(`/login?redirect=${encodeURIComponent(o)}`)}}catch(o){console.warn("Auth initialization failed in auth middleware:",o),t.tokenUtils.clearTokens();const c=e.fullPath!=="/login"?e.fullPath:"/";return i(`/login?redirect=${encodeURIComponent(c)}`)}console.log("âœ… User authenticated, allowing access to protected route")}catch(n){console.error("Error in auth middleware:",n);const t=e.fullPath!=="/login"?e.fullPath:"/";return i(`/login?redirect=${encodeURIComponent(t)}`)}});export{P as default};
