import{_ as R}from"./9ykhWItT.js";import{d as T,I as j,A as q,B as G,r as h,e as J,x as K,u as O,c as l,f as e,a as d,w as y,h as s,s as _,_ as Q,o as i,g as k,z as w,L as P,t as u,F as U,k as W}from"./BE3ND16f.js";import{_ as X}from"./CW04_7D2.js";const Y={class:"max-w-4xl mx-auto space-y-6"},Z={class:"flex items-center justify-between"},F={class:"flex items-center space-x-3"},tt={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-8 text-center"},et={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6"},at={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ot={class:"lg:col-span-2 space-y-6"},rt=["value","onInput"],st={key:0,class:"text-red-500 text-sm mt-1"},nt=["value","onInput"],lt={key:0,class:"text-red-500 text-sm mt-1"},it=["value","onInput"],dt={class:"space-y-6"},ut={class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},ct={class:"space-y-1 text-xs text-gray-600 dark:text-gray-400"},pt=["value","onChange"],mt=["value"],gt={key:0,class:"text-red-500 text-sm mt-1"},xt=["value","onChange"],yt={class:"flex items-center"},bt=["checked","onChange"],vt={key:2,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-8 text-center"},wt=T({__name:"edit",setup(ft){const{handleSuccess:B,handleError:x}=j(),C=q(),A=G(),b=h(!0),o=h(null),v=h([]),I=J(()=>o.value?{title:o.value.titulo||o.value.title||"",content:o.value.contenido||o.value.content||"",excerpt:o.value.meta_description||o.value.excerpt||"",status:o.value.status||"draft",category:o.value.categoria||o.value.category_id||"",featured:o.value.featured||!1}:{}),N={title:a=>!a||a.trim().length<5?"El título debe tener al menos 5 caracteres":null,content:a=>!a||a.trim().length<20?"El contenido debe tener al menos 20 caracteres":null,category:a=>a?null:"Debes seleccionar una categoría"},$=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",S=async a=>{await E(a,"published")},V=async a=>{await E(a,"draft")},D=()=>{C.push("/admin/posts")},E=async(a,t)=>{try{const{token:n}=_();if(!n.value){x("No se encontró token de autenticación","updatePost");return}const g={titulo:a.title,contenido:a.content,status:t,featured:a.featured,categoria:a.category,meta_title:a.title,meta_description:a.excerpt};await $fetch(`/api/v1/dashboard/api/posts/${A.params.id}/`,{method:"PATCH",body:g,headers:{Authorization:`Bearer ${n.value}`}}),B(`Post ${t==="published"?"actualizado y publicado":"guardado como borrador"} exitosamente`),C.push("/admin/posts")}catch(n){throw x(n,"updatePost"),n}},L=async()=>{try{b.value=!0;const{token:a}=_();if(!a.value){x("No se encontró token de autenticación","fetchPost");return}const t=await $fetch(`/api/v1/dashboard/api/posts/${A.params.id}/`,{headers:{Authorization:`Bearer ${a.value}`}});o.value=t}catch(a){console.error("Error fetching post:",a),x("Error al cargar el post","fetchPost")}finally{b.value=!1}},H=async()=>{try{const{token:a}=_();if(!a.value)return;const t=await $fetch("/api/v1/dashboard/api/categories/",{headers:{Authorization:`Bearer ${a.value}`}});v.value=t.results||t}catch(a){console.error("Error fetching categories:",a);try{const t=await $fetch("/api/v1/categories/");v.value=t.results||t}catch(t){console.error("Error fetching categories from fallback:",t)}}};return K(()=>{L(),H()}),O({title:"Editar Post - Administración",meta:[{name:"description",content:"Editar post del blog"}]}),(a,t)=>{var z;const n=R,g=Q,M=X;return i(),l("div",Y,[e("div",Z,[t[2]||(t[2]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Editar Post "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Modifica el artículo del blog ")],-1)),e("div",F,[d(g,{to:`/posts/${(z=s(o))==null?void 0:z.slug}`,target:"_blank",class:"btn btn-outline"},{default:y(()=>[d(n,{name:"eye",class:"w-4 h-4 mr-2"}),t[0]||(t[0]=k(" Ver Post ",-1))]),_:1,__:[0]},8,["to"]),d(g,{to:"/admin/posts",class:"btn btn-secondary"},{default:y(()=>[d(n,{name:"arrow-left",class:"w-4 h-4 mr-2"}),t[1]||(t[1]=k(" Volver ",-1))]),_:1,__:[1]})])]),s(b)?(i(),l("div",tt,[d(n,{name:"loading",class:"w-8 h-8 animate-spin mx-auto mb-4 text-gray-400"}),t[3]||(t[3]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando post...",-1))])):s(o)?(i(),l("div",et,[d(M,{"initial-data":s(I),"validation-rules":N,"submit-text":"Actualizar Post","draft-text":"Guardar Borrador","show-draft":!0,"is-draftable":!0,onSubmit:S,onDraft:V,onCancel:D},{default:y(({form:c,setField:p,getError:f,hasError:m})=>[e("div",at,[e("div",ot,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Título * ",-1)),e("input",{value:c.title,onInput:r=>p("title",r.target.value),type:"text",class:P(["input w-full",{"border-red-500":m("title")}]),placeholder:"Ingresa el título del post"},null,42,rt),m("title")?(i(),l("p",st,u(f("title")),1)):w("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Contenido * ",-1)),e("textarea",{value:c.content,onInput:r=>p("content",r.target.value),rows:"15",class:P(["input w-full resize-none",{"border-red-500":m("content")}]),placeholder:"Escribe el contenido del post..."},null,42,nt),m("content")?(i(),l("p",lt,u(f("content")),1)):w("",!0),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"}," Puedes usar Markdown para formatear el contenido ",-1))]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Extracto ",-1)),e("textarea",{value:c.excerpt,onInput:r=>p("excerpt",r.target.value),rows:"3",class:"input w-full",placeholder:"Breve descripción del post (opcional)"},null,40,it)])]),e("div",dt,[e("div",ut,[t[8]||(t[8]=e("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"}," Información del Post ",-1)),e("div",ct,[e("p",null,"Creado: "+u($(s(o).fecha_creacion||s(o).created_at)),1),e("p",null,"Actualizado: "+u($(s(o).fecha_actualizacion||s(o).updated_at)),1),e("p",null,"Autor: "+u(s(o).autor_username||s(o).author_username||"Desconocido"),1)])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Categoría * ",-1)),e("select",{value:c.category,onChange:r=>p("category",r.target.value),class:P(["input w-full",{"border-red-500":m("category")}])},[t[9]||(t[9]=e("option",{value:""},"Seleccionar categoría",-1)),(i(!0),l(U,null,W(s(v),r=>(i(),l("option",{key:r.id,value:r.id},u(r.name||r.nombre),9,mt))),128))],42,pt),m("category")?(i(),l("p",gt,u(f("category")),1)):w("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Estado ",-1)),e("select",{value:c.status,onChange:r=>p("status",r.target.value),class:"input w-full"},t[11]||(t[11]=[e("option",{value:"draft"},"Borrador",-1),e("option",{value:"published"},"Publicado",-1),e("option",{value:"archived"},"Archivado",-1)]),40,xt)]),e("div",null,[e("label",yt,[e("input",{checked:c.featured,onChange:r=>p("featured",r.target.checked),type:"checkbox",class:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"},null,40,bt),t[13]||(t[13]=e("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"}," Post destacado ",-1))])])])])]),_:1},8,["initial-data"])])):(i(),l("div",vt,[d(n,{name:"exclamation-triangle",class:"w-12 h-12 mx-auto mb-4 text-red-400"}),t[15]||(t[15]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," Post no encontrado ",-1)),t[16]||(t[16]=e("p",{class:"text-gray-600 dark:text-gray-400 mb-4"}," El post que intentas editar no existe o no tienes permisos para acceder a él. ",-1)),d(g,{to:"/admin/posts",class:"btn btn-primary"},{default:y(()=>t[14]||(t[14]=[k(" Volver a Posts ",-1)])),_:1,__:[14]})]))])}}});export{wt as default};
