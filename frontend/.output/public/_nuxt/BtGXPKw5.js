import{_ as I}from"./9ykhWItT.js";import{d as q,I as G,r as u,J as R,x as J,u as Q,c as i,f as e,z as T,a as l,w,n as P,v as K,h as r,p as $,H as V,F as C,k as E,l as O,t as p,s as y,_ as W,o as n,g as L,L as A,D as X}from"./BE3ND16f.js";import{u as Y}from"./CRYnRe3J.js";const Z={class:"space-y-6"},tt={class:"flex items-center justify-between"},et={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4"},at={class:"flex flex-wrap gap-4"},st={class:"flex-1 min-w-64"},rt=["value"],ot={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},nt={key:0,class:"p-8 text-center"},it={key:1,class:"p-8 text-center"},lt={class:"text-gray-600 dark:text-gray-400 mb-4"},dt={key:2,class:"overflow-x-auto"},ct={class:"w-full"},ut={class:"divide-y divide-gray-200 dark:divide-gray-700"},pt={class:"px-6 py-4"},xt={class:"flex items-center"},gt={class:"text-sm font-medium text-gray-900 dark:text-white"},ht={class:"text-sm text-gray-500 dark:text-gray-400"},mt={class:"px-6 py-4 whitespace-nowrap"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},ft={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},bt={class:"flex items-center justify-end space-x-2"},kt=["onClick"],_t=["onClick","title"],wt=["onClick"],Pt={key:0,class:"flex justify-center"},$t={class:"flex space-x-2"},Ct=["onClick"],Nt=q({__name:"index",setup(Et){const{handleSuccess:S,handleError:g}=G(),v=u(!1),h=u([]),B=u([]),x=u(""),d=u(""),c=u(""),m=u(1),f=u(1),z=s=>({published:"Publicado",draft:"Borrador",archived:"Archivado"})[s]||s,F=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A",b=async()=>{try{v.value=!0;const{token:s}=y();if(!s.value){g("No se encontró token de autenticación","fetchPosts");return}const t=new URLSearchParams;x.value&&t.append("search",x.value),d.value&&t.append("status",d.value),c.value&&t.append("categoria",c.value),t.append("page",m.value.toString());const o=await $fetch(`/api/v1/dashboard/api/posts/?${t}`,{headers:{Authorization:`Bearer ${s.value}`}});h.value=o.results||o,f.value=Math.ceil((o.count||h.value.length)/10)}catch(s){console.error("Error fetching posts:",s),g("Error al cargar los posts","fetchPosts")}finally{v.value=!1}},H=async()=>{try{const{token:s}=y();if(!s.value)return;const t=await $fetch("/api/v1/dashboard/api/categories/",{headers:{Authorization:`Bearer ${s.value}`}});B.value=t.results||t}catch(s){console.error("Error fetching categories:",s)}},M=s=>{X(`/admin/posts/${s.id}/edit`)},U=async s=>{try{const t=s.status==="published"?"draft":"published",{token:o}=y();if(!o.value){g("No se encontró token de autenticación","togglePostStatus");return}await $fetch(`/api/v1/dashboard/api/posts/${s.id}/`,{method:"PATCH",body:{status:t},headers:{Authorization:`Bearer ${o.value}`}}),s.status=t,S(`Post ${t==="published"?"publicado":"despublicado"} exitosamente`)}catch{g("Error al cambiar el estado del post","togglePostStatus")}},j=async s=>{if(confirm(`¿Estás seguro de que quieres eliminar "${s.titulo||s.title}"?`))try{const{token:t}=y();if(!t.value){g("No se encontró token de autenticación","deletePost");return}await $fetch(`/api/v1/dashboard/api/posts/${s.id}/`,{method:"DELETE",headers:{Authorization:`Bearer ${t.value}`}}),h.value=h.value.filter(o=>o.id!==s.id),S("Post eliminado exitosamente")}catch{g("Error al eliminar el post","deletePost")}},N=Y(()=>{m.value=1,b()},500);return R([d,c,m],()=>{b()}),J(()=>{b(),H()}),Q({title:"Gestionar Posts - Administración",meta:[{name:"description",content:"Administrar posts del blog"}]}),(s,t)=>{const o=I,k=W;return n(),i("div",Z,[e("div",tt,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Gestionar Posts "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Administra todos los posts del blog ")],-1)),l(k,{to:"/admin/posts/create",class:"btn btn-primary"},{default:w(()=>[l(o,{name:"plus",class:"w-4 h-4 mr-2"}),t[4]||(t[4]=L(" Crear Post ",-1))]),_:1,__:[4]})]),e("div",et,[e("div",at,[e("div",st,[P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>$(x)?x.value=a:null),type:"text",placeholder:"Buscar posts...",class:"input w-full",onInput:t[1]||(t[1]=(...a)=>r(N)&&r(N)(...a))},null,544),[[K,r(x)]])]),P(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>$(d)?d.value=a:null),class:"input"},t[6]||(t[6]=[e("option",{value:""},"Todos los estados",-1),e("option",{value:"published"},"Publicados",-1),e("option",{value:"draft"},"Borradores",-1),e("option",{value:"archived"},"Archivados",-1)]),512),[[V,r(d)]]),P(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>$(c)?c.value=a:null),class:"input"},[t[7]||(t[7]=e("option",{value:""},"Todas las categorías",-1)),(n(!0),i(C,null,E(r(B),a=>(n(),i("option",{key:a.id,value:a.id},p(a.name||a.nombre),9,rt))),128))],512),[[V,r(c)]])])]),e("div",ot,[r(v)?(n(),i("div",nt,[l(o,{name:"loading",class:"w-8 h-8 animate-spin mx-auto mb-4 text-gray-400"}),t[8]||(t[8]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando posts...",-1))])):r(h).length===0?(n(),i("div",it,[l(o,{name:"document-text",class:"w-12 h-12 mx-auto mb-4 text-gray-400"}),t[10]||(t[10]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," No hay posts ",-1)),e("p",lt,p(r(x)||r(d)||r(c)?"No se encontraron posts con los filtros aplicados.":"Aún no has creado ningún post."),1),!r(x)&&!r(d)&&!r(c)?(n(),O(k,{key:0,to:"/admin/posts/create",class:"btn btn-primary"},{default:w(()=>t[9]||(t[9]=[L(" Crear tu primer post ",-1)])),_:1,__:[9]})):T("",!0)])):(n(),i("div",dt,[e("table",ct,[t[11]||(t[11]=e("thead",{class:"bg-gray-50 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Título "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Estado "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Categoría "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Fecha "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",ut,[(n(!0),i(C,null,E(r(h),a=>{var _;return n(),i("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[e("td",pt,[e("div",xt,[e("div",null,[e("div",gt,p(a.titulo||a.title),1),e("div",ht,p(a.excerpt||((_=a.contenido||a.content)==null?void 0:_.substring(0,100))+"..."),1)])])]),e("td",mt,[e("span",{class:A([{"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":a.status==="published","bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":a.status==="draft","bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200":a.status==="archived"},"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},p(z(a.status)),3)]),e("td",yt,p(a.categoria_nombre||a.category_name||"Sin categoría"),1),e("td",vt,p(F(a.fecha_creacion||a.created_at)),1),e("td",ft,[e("div",bt,[l(k,{to:`/posts/${a.slug}`,target:"_blank",class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Ver post"},{default:w(()=>[l(o,{name:"eye",class:"w-4 h-4"})]),_:2},1032,["to"]),e("button",{onClick:D=>M(a),class:"text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300",title:"Editar"},[l(o,{name:"pencil",class:"w-4 h-4"})],8,kt),e("button",{onClick:D=>U(a),class:A({"text-green-600 hover:text-green-900":a.status!=="published","text-yellow-600 hover:text-yellow-900":a.status==="published"}),title:a.status==="published"?"Despublicar":"Publicar"},[l(o,{name:a.status==="published"?"eye-slash":"eye",class:"w-4 h-4"},null,8,["name"])],10,_t),e("button",{onClick:D=>j(a),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Eliminar"},[l(o,{name:"trash",class:"w-4 h-4"})],8,wt)])])])}),128))])])]))]),r(f)>1?(n(),i("div",Pt,[e("nav",$t,[(n(!0),i(C,null,E(r(f),a=>(n(),i("button",{key:a,onClick:_=>m.value=a,class:A([{"bg-primary-600 text-white":a===r(m),"bg-white text-gray-700 hover:bg-gray-50":a!==r(m)},"px-3 py-2 text-sm font-medium rounded-md border border-gray-300"])},p(a),11,Ct))),128))])])):T("",!0)])}}});export{Nt as default};
