import{al as k,r as h,e as x,am as v,q as V,I as B}from"./BE3ND16f.js";const H=(t,u)=>{var g,d,n,o;const c={message:((g=t==null?void 0:t.data)==null?void 0:g.message)||((d=t==null?void 0:t.data)==null?void 0:d.error)||(t==null?void 0:t.message)||(t==null?void 0:t.statusMessage)||"Error desconocido",code:((n=t==null?void 0:t.data)==null?void 0:n.code)||(t==null?void 0:t.code),status:(t==null?void 0:t.statusCode)||(t==null?void 0:t.status),context:u||"Unknown context",timestamp:new Date,url:((o=t==null?void 0:t.data)==null?void 0:o.url)||window.location.href};return console.error("ðŸš¨ API Error:",c),c},M=(t,u)=>{var g,d,n;const c={message:((g=t==null?void 0:t.data)==null?void 0:g.message)||(t==null?void 0:t.message)||"Error de autenticaciÃ³n",code:((d=t==null?void 0:t.data)==null?void 0:d.code)||(t==null?void 0:t.code),status:(t==null?void 0:t.statusCode)||(t==null?void 0:t.status),context:u||"Auth context",timestamp:new Date,url:((n=t==null?void 0:t.data)==null?void 0:n.url)||window.location.href};console.error("ðŸ” Auth Error:",c);try{localStorage.removeItem("auth_tokens")}catch{}return c},Q=(t,u)=>{var g,d,n,o,i;const c={message:((g=t==null?void 0:t.data)==null?void 0:g.message)||(t==null?void 0:t.message)||"Error de validaciÃ³n",code:((d=t==null?void 0:t.data)==null?void 0:d.code)||(t==null?void 0:t.code),status:(t==null?void 0:t.statusCode)||(t==null?void 0:t.status),context:u||"Validation context",timestamp:new Date,url:((n=t==null?void 0:t.data)==null?void 0:n.url)||window.location.href};return console.error("ðŸ“ Validation Error:",c),((o=t==null?void 0:t.data)!=null&&o.errors||t!=null&&t.errors)&&console.error("Validation details:",((i=t.data)==null?void 0:i.errors)||t.errors),c},T=(t,u)=>{var g,d,n;const c={message:((g=t==null?void 0:t.data)==null?void 0:g.message)||(t==null?void 0:t.message)||"Error de conexiÃ³n",code:((d=t==null?void 0:t.data)==null?void 0:d.code)||(t==null?void 0:t.code),status:(t==null?void 0:t.statusCode)||(t==null?void 0:t.status),context:u||"Network context",timestamp:new Date,url:((n=t==null?void 0:t.data)==null?void 0:n.url)||window.location.href};return console.error("ðŸŒ Network Error:",c),navigator.onLine===!1&&console.warn("ðŸ”Œ Device appears to be offline"),c},L=(t,u)=>{const c=(t==null?void 0:t.statusCode)||(t==null?void 0:t.status);return c===401||c===403?M(t,u):c===422||c===400?Q(t,u):c>=500?T(t,u):H(t,u)},$=k("blog",()=>{const t=h([]),u=h(null),c=h([]),g=h([]),d=h([]),n=h(!1),o=h(null),i=h({page:1,hasNext:!1,hasPrevious:!1,total:0,pageSize:12}),p=h(""),y=h({}),E=()=>V(),f=()=>{try{return B()}catch{return{handleError:(s,e)=>({message:s.message||`Error in ${e}`})}}},m=x(()=>t.value.filter(a=>a.status==="published")),I=x(()=>{const a={};return m.value.forEach(s=>{const e=s.category.slug;a[e]||(a[e]=[]),a[e].push(s)}),a}),S=x(()=>m.value.sort((a,s)=>new Date(s.published_at||s.created_at).getTime()-new Date(a.published_at||a.created_at).getTime()).slice(0,5)),P=async(a={})=>{try{n.value=!0,o.value=null;const s=E(),{handleError:e}=f(),l=await s.getPosts({page_size:i.value.pageSize,...a});a.page===1||!a.page?t.value=l.results||l.data||[]:t.value.push(...l.results||l.data||[]),i.value={...i.value,page:a.page||1,hasNext:!!l.next,hasPrevious:!!l.previous,total:l.count||0}}catch(s){const e=L(s,"fetchPosts");o.value=e.message,console.error("Error fetching posts:",s)}finally{n.value=!1}},N=async a=>{try{if(n.value=!0,o.value=null,!a||a==="undefined"||a==="null")throw console.error("âŒ Intento de fetch con slug invÃ¡lido:",a),new Error("Slug de post invÃ¡lido");console.log("ðŸ“– Fetching post from store with slug:",a);const s=E(),{handleError:e}=f(),l=await s.getPost(a);u.value=l.data||l}catch(s){const{handleError:e}=f(),l=e(s,"fetchPost");throw o.value=l.message,console.error("Error fetching post:",s),s}finally{n.value=!1}},A=async()=>{try{const a=E(),{handleError:s}=f();console.log("ðŸ“‚ Cargando categorÃ­as...");const e=await a.getCategories();c.value=e.data||e.results||[],console.log("âœ… CategorÃ­as cargadas:",c.value.length)}catch(a){console.error("âŒ Error cargando categorÃ­as:",a);const{handleError:s}=f();s(a,"fetchCategories"),c.value=[]}},D=async()=>{try{const a=E(),{handleError:s}=f(),e=await a.getFeaturedPosts();d.value=e.data||e.results||[]}catch(a){const{handleError:s}=f();s(a,"fetchFeaturedPosts"),console.error("Error fetching featured posts:",a)}},C=async(a,s={})=>{try{n.value=!0,o.value=null,p.value=a,y.value=s;const e=E(),{handleError:l}=f(),w=await e.searchPosts({query:a,...s});t.value=w.results||w.data||[],i.value={...i.value,page:1,hasNext:!!w.next,hasPrevious:!1,total:w.count}}catch(e){const{handleError:l}=f(),w=l(e,"searchPosts");o.value=w.message,console.error("Error searching posts:",e)}finally{n.value=!1}},F=async(a,s={})=>{try{n.value=!0,o.value=null;const l=await E().getCategoryPosts(a,{page_size:i.value.pageSize,...s});s.page===1||!s.page?t.value=l.results||l.data||[]:t.value.push(...l.results||l.data||[]),i.value={...i.value,page:s.page||1,hasNext:!!l.next,hasPrevious:!!l.previous,total:l.count}}catch(e){o.value=e.message||"Failed to fetch category posts",console.error("Error fetching category posts:",e)}finally{n.value=!1}},_=async()=>{if(!i.value.hasNext||n.value)return;const a=i.value.page+1;p.value?await C(p.value,{...y.value}):await P({page:a})},z=()=>{p.value="",y.value={},P()},b=()=>{t.value=[],u.value=null,n.value=!1,o.value=null,i.value={page:1,hasNext:!1,hasPrevious:!1,total:0,pageSize:12},p.value="",y.value={}};return{posts:v(t),currentPost:v(u),categories:v(c),tags:v(g),featuredPosts:v(d),loading:v(n),error:v(o),pagination:v(i),searchQuery:v(p),activeFilters:v(y),publishedPosts:m,postsByCategory:I,recentPosts:S,fetchPosts:P,fetchPost:N,fetchCategories:A,fetchFeaturedPosts:D,searchPosts:C,fetchPostsByCategory:F,loadMorePosts:_,clearSearch:z,resetState:b}});export{$ as u};
