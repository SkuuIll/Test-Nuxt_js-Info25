import{_ as M}from"./9ykhWItT.js";import{d as P,I as L,r as m,J as R,x as V,u as F,c as n,f as e,z as b,n as $,H,h as o,p as A,v as I,a as x,t as d,F as E,k as j,s as _,o as i,L as z}from"./BE3ND16f.js";import{u as T}from"./CRYnRe3J.js";const U={class:"space-y-6"},q={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4"},G={class:"flex flex-wrap gap-4"},J={class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"},Q={key:0,class:"p-8 text-center"},K={key:1,class:"p-8 text-center"},O={class:"text-gray-600 dark:text-gray-400"},W={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700"},X={class:"flex items-start justify-between"},Y={class:"flex-1"},Z={class:"flex items-center space-x-2 mb-2"},ee={class:"flex items-center space-x-2"},te={class:"w-8 h-8 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center"},ae={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},re={class:"text-sm font-medium text-gray-900 dark:text-white"},se={class:"text-xs text-gray-500 dark:text-gray-400"},oe={class:"mb-3"},ne={class:"text-sm text-gray-900 dark:text-white"},ie={class:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400"},de={class:"flex items-center space-x-2 ml-4"},le=["onClick"],ce=["onClick"],ue=["onClick"],he={key:0,class:"flex justify-center"},pe={class:"flex space-x-2"},me=["onClick"],fe=P({__name:"index",setup(xe){const{handleSuccess:k,handleError:c}=L(),g=m(!1),u=m([]),h=m(""),l=m("pending"),p=m(1),v=m(1),N=r=>({pending:"Pendiente",approved:"Aprobado",rejected:"Rechazado"})[r]||r,S=r=>r.split(" ").map(a=>a.charAt(0)).join("").toUpperCase().substring(0,2),D=r=>r?new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",y=async()=>{try{g.value=!0;const{token:r}=_();if(!r.value){c("No se encontró token de autenticación","fetchComments");return}const a=new URLSearchParams;h.value&&a.append("search",h.value),l.value&&a.append("status",l.value),a.append("page",p.value.toString());const s=await $fetch(`/api/v1/dashboard/api/comments/?${a}`,{headers:{Authorization:`Bearer ${r.value}`}});u.value=s.results||s,v.value=Math.ceil((s.count||u.value.length)/10)}catch(r){console.error("Error fetching comments:",r),c("Error al cargar los comentarios","fetchComments")}finally{g.value=!1}},w=async(r,a)=>{try{const{token:s}=_();if(!s.value){c("No se encontró token de autenticación","moderateComment");return}await $fetch(`/api/v1/dashboard/api/comments/${r.id}/`,{method:"PATCH",body:{status:a},headers:{Authorization:`Bearer ${s.value}`}}),r.status=a,k(`Comentario ${a==="approved"?"aprobado":"rechazado"} exitosamente`)}catch{c("Error al moderar el comentario","moderateComment")}},B=async r=>{if(confirm("¿Estás seguro de que quieres eliminar este comentario?"))try{const{token:a}=_();if(!a.value){c("No se encontró token de autenticación","deleteComment");return}await $fetch(`/api/v1/dashboard/api/comments/${r.id}/`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`}}),u.value=u.value.filter(s=>s.id!==r.id),k("Comentario eliminado exitosamente")}catch{c("Error al eliminar el comentario","deleteComment")}},C=T(()=>{p.value=1,y()},500);return R([l,p],()=>{y()}),V(()=>{y()}),F({title:"Moderar Comentarios - Administración",meta:[{name:"description",content:"Moderar comentarios del blog"}]}),(r,a)=>{const s=M;return i(),n("div",U,[a[6]||(a[6]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Moderar Comentarios "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Gestiona los comentarios del blog ")])],-1)),e("div",q,[e("div",G,[$(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>A(l)?l.value=t:null),class:"input"},a[3]||(a[3]=[e("option",{value:""},"Todos los comentarios",-1),e("option",{value:"pending"},"Pendientes",-1),e("option",{value:"approved"},"Aprobados",-1),e("option",{value:"rejected"},"Rechazados",-1)]),512),[[H,o(l)]]),$(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>A(h)?h.value=t:null),type:"text",placeholder:"Buscar comentarios...",class:"input flex-1 min-w-64",onInput:a[2]||(a[2]=(...t)=>o(C)&&o(C)(...t))},null,544),[[I,o(h)]])])]),e("div",J,[o(g)?(i(),n("div",Q,[x(s,{name:"loading",class:"w-8 h-8 animate-spin mx-auto mb-4 text-gray-400"}),a[4]||(a[4]=e("p",{class:"text-gray-600 dark:text-gray-400"},"Cargando comentarios...",-1))])):o(u).length===0?(i(),n("div",K,[x(s,{name:"chat-bubble-left-right",class:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a[5]||(a[5]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," No hay comentarios ",-1)),e("p",O,d(o(h)||o(l)?"No se encontraron comentarios con los filtros aplicados.":"Aún no hay comentarios para moderar."),1)])):(i(),n("div",W,[(i(!0),n(E,null,j(o(u),t=>(i(),n("div",{key:t.id,class:"p-6 hover:bg-gray-50 dark:hover:bg-gray-700"},[e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("span",ae,d(S(t.autor_nombre||t.author_name||"Anónimo")),1)]),e("div",null,[e("p",re,d(t.autor_nombre||t.author_name||"Anónimo"),1),e("p",se,d(t.email||"Sin email"),1)])]),e("span",{class:z([{"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":t.status==="pending","bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":t.status==="approved","bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":t.status==="rejected"},"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},d(N(t.status)),3)]),e("div",oe,[e("p",ne,d(t.contenido||t.content),1)]),e("div",ie,[e("span",null," Post: "+d(t.post_titulo||t.post_title||"Desconocido"),1),e("span",null,d(D(t.fecha_creacion||t.created_at)),1)])]),e("div",de,[t.status!=="approved"?(i(),n("button",{key:0,onClick:f=>w(t,"approved"),class:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300",title:"Aprobar"},[x(s,{name:"check",class:"w-4 h-4"})],8,le)):b("",!0),t.status!=="rejected"?(i(),n("button",{key:1,onClick:f=>w(t,"rejected"),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Rechazar"},[x(s,{name:"x",class:"w-4 h-4"})],8,ce)):b("",!0),e("button",{onClick:f=>B(t),class:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300",title:"Eliminar"},[x(s,{name:"trash",class:"w-4 h-4"})],8,ue)])])]))),128))]))]),o(v)>1?(i(),n("div",he,[e("nav",pe,[(i(!0),n(E,null,j(o(v),t=>(i(),n("button",{key:t,onClick:f=>p.value=t,class:z([{"bg-primary-600 text-white":t===o(p),"bg-white text-gray-700 hover:bg-gray-50":t!==o(p)},"px-3 py-2 text-sm font-medium rounded-md border border-gray-300"])},d(t),11,me))),128))])])):b("",!0)])}}});export{fe as default};
